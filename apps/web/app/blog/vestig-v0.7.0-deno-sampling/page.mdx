export const metadata = {
  title: 'Vestig v0.7.0: Full Deno Support, Advanced Sampling & More',
  description: 'Announcing Vestig v0.7.0 with full Deno runtime support, W3C tracestate, advanced sampling strategies, and VestigErrorBoundary for React.',
  openGraph: {
    title: 'Vestig v0.7.0: Full Deno Support, Advanced Sampling & More',
    description: 'Announcing Vestig v0.7.0 with full Deno runtime support, W3C tracestate, advanced sampling strategies, and VestigErrorBoundary for React.',
    type: 'article',
    publishedTime: '2025-12-22T00:00:00.000Z',
    images: [
      {
        url: 'https://vestig.dev/og-image.svg',
        width: 1200,
        height: 630,
        alt: 'Vestig v0.7.0 - Full Deno Support, Advanced Sampling & More',
      },
    ],
  },
  twitter: {
    card: 'summary_large_image',
    title: 'Vestig v0.7.0: Full Deno Support, Advanced Sampling & More',
    description: 'Announcing Vestig v0.7.0 with full Deno runtime support, W3C tracestate, advanced sampling strategies, and VestigErrorBoundary for React.',
    images: ['https://vestig.dev/og-image.svg'],
  },
  alternates: {
    canonical: 'https://vestig.dev/blog/vestig-v0.7.0-deno-sampling',
  },
}

# Vestig v0.7.0: Full Deno Support, Advanced Sampling & More

<div className="text-white/50 text-sm mb-8">December 22, 2025 ¬∑ 5 min read</div>

We're excited to announce **Vestig v0.7.0**, a major release that delivers on our promise of true multi-runtime support and adds powerful new features for production observability.

## What's New in v0.7.0

### ü¶ï Full Deno Support

Vestig now runs natively on Deno 2.0+, making it the only zero-dependency logging library that works seamlessly across **Node.js, Bun, Deno, Edge runtimes, and browsers**.

```typescript
// Works identically in Deno, Node.js, Bun, and browsers
import { log, RUNTIME, IS_DENO } from 'vestig'

log.info('Hello from Deno!', { runtime: RUNTIME })
// Output: { runtime: 'deno' }
```

The implementation uses Deno's Node.js compatibility layer for `AsyncLocalStorage` via `node:async_hooks`, ensuring context propagation works correctly across async operations.

### üìä Advanced Sampling Strategies

Control your log volume intelligently with four new sampling strategies:

**Probability Sampling** - Sample a percentage of logs:
```typescript
import { createLogger, createProbabilitySampler } from 'vestig'

const log = createLogger({
  sampler: createProbabilitySampler(0.1) // 10% of logs
})
```

**Rate Limiting** - Cap logs per time window:
```typescript
import { createRateLimitSampler } from 'vestig'

const sampler = createRateLimitSampler({
  maxPerSecond: 100 // Max 100 logs/second
})
```

**Namespace-Based** - Different rates per module:
```typescript
import { createNamespaceSampler } from 'vestig'

const sampler = createNamespaceSampler({
  'api.*': 0.5,      // 50% of API logs
  'db.query': 0.01,  // 1% of DB queries
  'auth.*': 1.0      // 100% of auth logs
})
```

**Composite Sampling** - Combine multiple strategies:
```typescript
import { createCompositeSampler } from 'vestig'

const sampler = createCompositeSampler([
  createRateLimitSampler({ maxPerSecond: 1000 }),
  createNamespaceSampler({ 'debug.*': 0.1 })
])
```

### üåê W3C Trace Context: Tracestate Support

Building on our traceparent support, v0.7.0 adds full W3C tracestate compliance for vendor-specific tracing metadata:

```typescript
import { parseTracestate, createTracestate, setTracestateValue } from 'vestig'

// Parse incoming tracestate header
const state = parseTracestate('vendor1=value1,vendor2=value2')

// Create or modify tracestate
const newState = setTracestateValue(state, 'vestig', 'span-123')
// Result: 'vestig=span-123,vendor1=value1,vendor2=value2'
```

This enables seamless integration with OpenTelemetry-instrumented services and distributed tracing backends.

### ‚öõÔ∏è VestigErrorBoundary for React

Capture errors with full context in your React applications:

```tsx
import { VestigErrorBoundary, addBreadcrumb } from '@vestig/next/client'

// Add breadcrumbs for context
addBreadcrumb('user.navigate', { to: '/checkout' })
addBreadcrumb('cart.update', { items: 3 })

// Wrap your app
<VestigErrorBoundary
  fallback={<ErrorPage />}
  onError={(error, breadcrumbs) => {
    // breadcrumbs show the trail leading to the error
    log.error('React error', { error, breadcrumbs })
  }}
>
  <App />
</VestigErrorBoundary>
```

### üì¥ Offline Queue Persistence

Client-side logs now survive page reloads with localStorage persistence:

```typescript
import { useLogger } from '@vestig/next/client'

const log = useLogger({
  offline: {
    enabled: true,
    maxSize: 100,        // Max queued entries
    storageKey: 'vestig-offline'
  }
})

// Logs are queued when offline and sent when connection resumes
log.info('User action', { action: 'purchase' })
```

## Test Coverage

This release brings our test suite to **898 tests** with **1,706 assertions**, covering:

- 47 tests for W3C tracestate support
- 38 tests for DatadogTransport
- 41 tests for FileTransport
- 29 tests for VestigErrorBoundary
- 15 tests for offline queue persistence
- Comprehensive React hooks tests for @vestig/next/client

## Breaking Changes

None! v0.7.0 is fully backward compatible with v0.6.x.

## Upgrade

```bash
bun add vestig@latest
bun add @vestig/next@latest  # If using Next.js
```

## What's Next

We're working on **v0.8.0** which will bring:

- **OpenTelemetry Bridge** - Export Vestig traces to OTLP collectors
- **Trace Visualization** - ASCII waterfall diagrams in the console
- **Baggage Propagation** - W3C Baggage header support
- **Browser Performance Marks** - Integration with Performance API

## Thank You

Thank you to everyone who has tried Vestig, reported issues, and provided feedback. We're building observability that's actually enjoyable to use.

---

**Links:**
- [GitHub Repository](https://github.com/Arakiss/vestig)
- [Documentation](/docs)
- [v0.7.0 Release Notes](https://github.com/Arakiss/vestig/releases/tag/v0.7.0)
